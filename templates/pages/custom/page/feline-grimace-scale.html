{{#partial "page"}}
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Feline Grimace Scale</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #f7f4f0;
    --card: #ffffff;
    --purple: #546052;
    --purple-light: #edf1ec;
    --purple-mid: #859E7D;
    --accent: #a8c4a2;
    --text: #2a3329;
    --text-muted: #687E6B;
    --selected: #546052;
    --border: #d4ddd3;
    --score-low: #4caf87;
    --score-mid: #e8a020;
    --score-high: #e05555;
    --radius: 16px;
    --transition: 0.22s cubic-bezier(0.4,0,0.2,1);
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
  }

  body::before {
    content: '';
    position: fixed;
    top: -120px; right: -120px;
    width: 420px; height: 420px;
    background: radial-gradient(circle, #859e7d30 0%, transparent 70%);
    pointer-events: none;
    z-index: 0;
  }

  body::after {
    content: '';
    position: fixed;
    bottom: -80px; left: -80px;
    width: 320px; height: 320px;
    background: radial-gradient(circle, #687e6b20 0%, transparent 70%);
    pointer-events: none;
    z-index: 0;
  }

  .wrapper {
    max-width: 820px;
    margin: 0 auto;
    position: relative;
    z-index: 1;
  }

  header {
    text-align: center;
    margin-bottom: 40px;
    animation: fadeDown 0.6s ease both;
  }

  .paw-icon {
    font-size: 2.4rem;
    margin-bottom: 8px;
    display: block;
  }

  header h1 {
    font-family: 'Playfair Display', serif;
    font-size: clamp(1.8rem, 5vw, 2.8rem);
    font-weight: 700;
    color: var(--purple);
    line-height: 1.1;
    letter-spacing: -0.5px;
  }

  header p {
    margin-top: 10px;
    color: var(--text-muted);
    font-size: 0.95rem;
    font-weight: 300;
    max-width: 480px;
    margin-inline: auto;
    line-height: 1.6;
  }

  .notice {
    background: #fff8e6;
    border: 1.5px solid #f5c842;
    border-radius: 10px;
    padding: 12px 18px;
    font-size: 0.82rem;
    color: #7a5c00;
    text-align: center;
    margin-bottom: 32px;
    line-height: 1.5;
    animation: fadeDown 0.7s ease both;
  }

  .instructions {
    background: var(--purple-light);
    border-radius: var(--radius);
    padding: 18px 22px;
    margin-bottom: 32px;
    font-size: 0.88rem;
    color: var(--text);
    line-height: 1.7;
    animation: fadeDown 0.75s ease both;
  }

  .instructions strong { color: var(--purple); }

  .instructions .wait-list {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
    margin-top: 8px;
  }

  .wait-list span {
    background: white;
    border-radius: 20px;
    padding: 4px 14px;
    font-size: 0.82rem;
    font-weight: 500;
    color: var(--purple);
    border: 1.5px solid var(--purple-mid);
  }

  /* Action Unit Cards */
  .unit-card {
    background: var(--card);
    border-radius: var(--radius);
    border: 1.5px solid var(--border);
    margin-bottom: 24px;
    overflow: hidden;
    animation: fadeUp 0.5s ease both;
    box-shadow: 0 2px 20px #54605208;
    transition: box-shadow var(--transition);
  }

  .unit-card:hover { box-shadow: 0 6px 32px #54605214; }
  .unit-card:nth-child(1) { animation-delay: 0.1s; }
  .unit-card:nth-child(2) { animation-delay: 0.15s; }
  .unit-card:nth-child(3) { animation-delay: 0.2s; }
  .unit-card:nth-child(4) { animation-delay: 0.25s; }
  .unit-card:nth-child(5) { animation-delay: 0.3s; }

  .unit-header {
    background: var(--purple);
    color: white;
    padding: 14px 22px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .unit-header h2 {
    font-family: 'DM Sans', sans-serif;
    color: white;
    font-size: 0.82rem;
    font-weight: 600;
    letter-spacing: 2px;
    text-transform: uppercase;
  }

  .unit-header .unit-score-badge {
    margin-left: auto;
    background: rgba(255,255,255,0.2);
    border-radius: 20px;
    padding: 4px 14px;
    font-size: 0.82rem;
    font-weight: 600;
    transition: background var(--transition);
  }

  .unit-header .unit-score-badge.selected {
    background: white;
    color: var(--purple);
  }

  .options-row {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0;
    border-top: 1px solid var(--border);
  }

  .option-btn {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 24px 16px 20px;
    cursor: pointer;
    border: none;
    background: transparent;
    transition: background var(--transition);
    border-right: 1px solid var(--border);
    outline: none;
    text-align: center;
    -webkit-tap-highlight-color: transparent;
  }

  .option-btn:last-child { border-right: none; }

  .option-btn:hover { background: var(--purple-light); }

  .option-btn.selected {
    background: var(--purple-light);
  }

  .option-btn.selected::after {
    content: '';
    position: absolute;
    inset: 0;
    border: 2.5px solid var(--purple);
    border-radius: 0;
    pointer-events: none;
  }

  .option-btn:first-child.selected::after { border-radius: 0; }

  .score-pill {
    width: 32px; height: 32px;
    border-radius: 50%;
    border: 2.5px solid var(--border);
    display: flex; align-items: center; justify-content: center;
    font-weight: 700;
    font-size: 0.9rem;
    color: var(--text-muted);
    margin-bottom: 14px;
    transition: all var(--transition);
    background: white;
  }

  .option-btn.selected .score-pill {
    border-color: var(--purple);
    background: var(--purple);
    color: white;
    transform: scale(1.1);
  }

  .cat-illustration {
    width: 110px;
    height: 90px;
    margin-bottom: 12px;
  }

  .option-label {
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--text);
    line-height: 1.3;
    margin-bottom: 4px;
  }

  .option-sublabel {
    font-size: 0.72rem;
    color: var(--text-muted);
    line-height: 1.3;
    font-weight: 400;
  }

  /* Score Panel */
  .score-panel {
    background: var(--card);
    border-radius: var(--radius);
    border: 1.5px solid var(--border);
    overflow: hidden;
    animation: fadeUp 0.5s 0.4s ease both;
    box-shadow: 0 2px 20px #54605208;
  }

  .score-panel-header {
    background: var(--text);
    color: white;
    padding: 16px 22px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .score-panel-header h2 {
    color: white;
    font-family: 'Playfair Display', serif;
    font-size: 1.1rem;
    font-weight: 600;
  }

  .score-breakdown {
    display: flex;
    padding: 20px 22px 0;
    gap: 0;
    flex-wrap: wrap;
  }

  .score-item {
    flex: 1;
    min-width: 100px;
    text-align: center;
    padding: 12px 8px;
    border-right: 1px solid var(--border);
  }

  .score-item:last-child { border-right: none; }

  .score-item-label {
    font-size: 0.7rem;
    font-weight: 600;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: var(--text-muted);
    margin-bottom: 6px;
  }

  .score-item-value {
    font-family: 'Playfair Display', serif;
    font-size: 1.6rem;
    font-weight: 700;
    color: var(--text);
    transition: all var(--transition);
  }

  .total-section {
    padding: 20px 22px;
    display: flex;
    align-items: center;
    gap: 24px;
    border-top: 1.5px solid var(--border);
    margin-top: 16px;
    flex-wrap: wrap;
  }

  .total-number {
    font-family: 'Playfair Display', serif;
    font-size: 4rem;
    font-weight: 700;
    line-height: 1;
    min-width: 80px;
    text-align: center;
    transition: color 0.4s ease;
  }

  .total-number.color-0 { color: var(--score-low); }
  .total-number.color-mild { color: var(--score-low); }
  .total-number.color-pain { color: var(--score-mid); }
  .total-number.color-severe { color: var(--score-high); }

  .total-out-of {
    font-size: 1rem;
    color: var(--text-muted);
    font-weight: 300;
    align-self: flex-end;
    padding-bottom: 8px;
    margin-left: -16px;
  }

  .interpretation {
    flex: 1;
    min-width: 200px;
  }

  .interp-badge {
    display: inline-block;
    border-radius: 20px;
    padding: 5px 16px;
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-bottom: 8px;
    transition: all 0.4s ease;
  }

  .badge-0, .badge-mild { background: #e8f5ef; color: #2d7a59; }
  .badge-pain { background: #fff3e0; color: #b56b00; }
  .badge-severe { background: #fde8e8; color: #c0392b; }

  .interp-text {
    font-size: 0.85rem;
    line-height: 1.6;
    color: var(--text);
    transition: opacity 0.3s ease;
  }

  .progress-bar-wrap {
    padding: 0 22px 22px;
  }

  .progress-label {
    display: flex;
    justify-content: space-between;
    font-size: 0.75rem;
    color: var(--text-muted);
    margin-bottom: 6px;
    font-weight: 500;
  }

  .progress-track {
    height: 8px;
    background: var(--border);
    border-radius: 20px;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    border-radius: 20px;
    width: 0%;
    transition: width 0.5s cubic-bezier(0.4,0,0.2,1), background 0.4s ease;
    background: var(--score-low);
  }

  .progress-fill.color-pain { background: var(--score-mid); }
  .progress-fill.color-severe { background: var(--score-high); }

  .cutoff-indicator {
    position: relative;
    height: 16px;
    margin-top: 4px;
  }

  .cutoff-line {
    position: absolute;
    left: 40%;
    top: 0;
    width: 2px;
    height: 14px;
    background: var(--score-mid);
    border-radius: 2px;
  }

  .cutoff-label {
    position: absolute;
    left: calc(40% + 5px);
    transform: translateX(-50%);
    top: 0;
    font-size: 0.65rem;
    color: var(--score-mid);
    font-weight: 600;
    white-space: nowrap;
    padding-left: 6px;
  }

  /* Animations */
  @keyframes fadeDown {
    from { opacity: 0; transform: translateY(-16px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes pop {
    0% { transform: scale(1); }
    50% { transform: scale(1.15); }
    100% { transform: scale(1); }
  }

  .pop-animate { animation: pop 0.3s ease; }

  /* SVG cat illustrations */
  svg { display: block; }

  @media (max-width: 600px) {
    .options-row { grid-template-columns: 1fr; }
    .option-btn { border-right: none; border-bottom: 1px solid var(--border); flex-direction: row; gap: 14px; text-align: left; padding: 16px; }
    .option-btn:last-child { border-bottom: none; }
    .cat-illustration { width: 70px; height: 60px; margin-bottom: 0; flex-shrink: 0; }
    .score-breakdown { gap: 0; }
    .score-item { min-width: 60px; }
    .total-section { gap: 14px; }
  }
</style>
</head>
<body>
<div class="wrapper">

  <header>
    <span class="paw-icon">üêæ</span>
    <h1>Feline Grimace Scale</h1>
    <p>Observe the cat undisturbed from a distance for 30 seconds, then score each action unit below.</p>
  </header>

  <div class="notice">
    ‚ö†Ô∏è <strong>For owners:</strong> Always consult your vet before administering any medication. Some human pain killers can be fatal to cats.
  </div>

  <div class="instructions">
    <strong>Observe the cat in real-time.</strong> Observe the cat awake and undisturbed from a distance for 30 seconds and then
score each FGS action unit. If the cat is doing any of the following, wait until they have finished before scoring.
    <div class="wait-list">
      <span>üßπ Grooming</span>
      <span>üò¥ Sleeping</span>
      <span>üéæ Playing</span>
      <span>üçΩÔ∏è Eating</span>
    </div>
  </div>

  <div id="units-container"></div>

  <div class="score-panel">
    <div class="score-panel-header">
      <h2>Your Scores</h2>
    </div>
    <div class="score-breakdown" id="score-breakdown"></div>
    <div class="total-section">
      <div>
        <div style="font-size:0.72rem;font-weight:600;letter-spacing:1.5px;text-transform:uppercase;color:var(--text-muted);margin-bottom:4px;">Total</div>
        <div style="display:flex;align-items:flex-end;gap:4px;">
          <div class="total-number color-0" id="total-display">0</div>
          <div class="total-out-of">/ 10</div>
        </div>
      </div>
      <div class="interpretation">
        <div class="interp-badge badge-0" id="interp-badge">No Pain</div>
        <div class="interp-text" id="interp-text">This cat is not in pain. If you are a cat owner and are concerned, please consult your veterinary surgeon.</div>
      </div>
    </div>
    <div class="progress-bar-wrap">
      <div class="progress-label">
        <span>0</span>
        <span>Rescue analgesia threshold: 4</span>
        <span>10</span>
      </div>
      <div class="progress-track">
        <div class="progress-fill" id="progress-fill"></div>
      </div>
      <div class="cutoff-indicator">
        <div class="cutoff-line"></div>
        <span class="cutoff-label">4</span>
      </div>
    </div>
  </div>

</div>

<script>
const units = [
  {
    id: 'ears',
    label: 'Ear Position',
    options: [
      {
        score: 0, label: 'Ears facing forward', sublabel: 'Absent',
        svg: `<svg viewBox="0 0 110 90" fill="none" xmlns="http://www.w3.org/2000/svg">
          <ellipse cx="55" cy="55" rx="30" ry="26" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <polygon points="32,36 22,14 44,30" fill="#edf1ec" stroke="#546052" stroke-width="1.5" stroke-linejoin="round"/>
          <polygon points="78,36 88,14 66,30" fill="#edf1ec" stroke="#546052" stroke-width="1.5" stroke-linejoin="round"/>
          <circle cx="44" cy="53" r="5" fill="#546052" opacity="0.7"/>
          <circle cx="66" cy="53" r="5" fill="#546052" opacity="0.7"/>
          <path d="M47 66 Q55 72 63 66" stroke="#546052" stroke-width="1.5" fill="none" stroke-linecap="round"/>
          <line x1="38" y1="56" x2="24" y2="52" stroke="#546052" stroke-width="1.2" stroke-linecap="round"/>
          <line x1="38" y1="59" x2="23" y2="59" stroke="#546052" stroke-width="1.2" stroke-linecap="round"/>
          <line x1="72" y1="56" x2="86" y2="52" stroke="#546052" stroke-width="1.2" stroke-linecap="round"/>
          <line x1="72" y1="59" x2="87" y2="59" stroke="#546052" stroke-width="1.2" stroke-linecap="round"/>
        </svg>`
      },
      {
        score: 1, label: 'Ears slightly pulled apart', sublabel: 'Moderately present or uncertain',
        svg: `<svg viewBox="0 0 110 90" fill="none" xmlns="http://www.w3.org/2000/svg">
          <ellipse cx="55" cy="55" rx="30" ry="26" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <polygon points="32,36 16,18 40,32" fill="#edf1ec" stroke="#546052" stroke-width="1.5" stroke-linejoin="round"/>
          <polygon points="78,36 94,18 70,32" fill="#edf1ec" stroke="#546052" stroke-width="1.5" stroke-linejoin="round"/>
          <circle cx="44" cy="53" r="5" fill="#546052" opacity="0.7"/>
          <circle cx="66" cy="53" r="5" fill="#546052" opacity="0.7"/>
          <path d="M47 66 Q55 71 63 66" stroke="#546052" stroke-width="1.5" fill="none" stroke-linecap="round"/>
          <line x1="38" y1="56" x2="24" y2="52" stroke="#546052" stroke-width="1.2" stroke-linecap="round"/>
          <line x1="38" y1="59" x2="23" y2="59" stroke="#546052" stroke-width="1.2" stroke-linecap="round"/>
          <line x1="72" y1="56" x2="86" y2="52" stroke="#546052" stroke-width="1.2" stroke-linecap="round"/>
          <line x1="72" y1="59" x2="87" y2="59" stroke="#546052" stroke-width="1.2" stroke-linecap="round"/>
        </svg>`
      },
      {
        score: 2, label: 'Ears rotated outwards', sublabel: 'Markedly present',
        svg: `<svg viewBox="0 0 110 90" fill="none" xmlns="http://www.w3.org/2000/svg">
          <ellipse cx="55" cy="55" rx="30" ry="26" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <polygon points="30,38 10,30 36,34" fill="#edf1ec" stroke="#546052" stroke-width="1.5" stroke-linejoin="round"/>
          <polygon points="80,38 100,30 74,34" fill="#edf1ec" stroke="#546052" stroke-width="1.5" stroke-linejoin="round"/>
          <circle cx="44" cy="53" r="5" fill="#546052" opacity="0.7"/>
          <circle cx="66" cy="53" r="5" fill="#546052" opacity="0.7"/>
          <path d="M47 66 Q55 70 63 66" stroke="#546052" stroke-width="1.5" fill="none" stroke-linecap="round"/>
          <line x1="38" y1="56" x2="24" y2="52" stroke="#546052" stroke-width="1.2" stroke-linecap="round"/>
          <line x1="38" y1="59" x2="23" y2="59" stroke="#546052" stroke-width="1.2" stroke-linecap="round"/>
          <line x1="72" y1="56" x2="86" y2="52" stroke="#546052" stroke-width="1.2" stroke-linecap="round"/>
          <line x1="72" y1="59" x2="87" y2="59" stroke="#546052" stroke-width="1.2" stroke-linecap="round"/>
        </svg>`
      }
    ]
  },
  {
    id: 'eyes',
    label: 'Orbital Tightening',
    options: [
      {
        score: 0, label: 'Eyes opened', sublabel: 'Absent',
        svg: `<svg viewBox="0 0 110 90" fill="none" xmlns="http://www.w3.org/2000/svg">
          <ellipse cx="55" cy="52" rx="30" ry="26" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <polygon points="32,34 22,14 44,30" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <polygon points="78,34 88,14 66,30" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <ellipse cx="42" cy="50" rx="8" ry="8" fill="white" stroke="#546052" stroke-width="1.5"/>
          <ellipse cx="68" cy="50" rx="8" ry="8" fill="white" stroke="#546052" stroke-width="1.5"/>
          <circle cx="42" cy="50" r="4" fill="#2a3329"/>
          <circle cx="68" cy="50" r="4" fill="#2a3329"/>
          <circle cx="44" cy="48" r="1.5" fill="white"/>
          <circle cx="70" cy="48" r="1.5" fill="white"/>
          <path d="M47 65 Q55 70 63 65" stroke="#546052" stroke-width="1.5" fill="none" stroke-linecap="round"/>
        </svg>`
      },
      {
        score: 1, label: 'Partially closed eyes', sublabel: 'Moderately present or uncertain',
        svg: `<svg viewBox="0 0 110 90" fill="none" xmlns="http://www.w3.org/2000/svg">
          <ellipse cx="55" cy="52" rx="30" ry="26" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <polygon points="32,34 22,14 44,30" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <polygon points="78,34 88,14 66,30" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <ellipse cx="42" cy="50" rx="8" ry="5.5" fill="white" stroke="#546052" stroke-width="1.5"/>
          <ellipse cx="68" cy="50" rx="8" ry="5.5" fill="white" stroke="#546052" stroke-width="1.5"/>
          <circle cx="42" cy="51" r="3.5" fill="#2a3329"/>
          <circle cx="68" cy="51" r="3.5" fill="#2a3329"/>
          <line x1="34" y1="45" x2="50" y2="45" stroke="#546052" stroke-width="1.8" stroke-linecap="round"/>
          <line x1="60" y1="45" x2="76" y2="45" stroke="#546052" stroke-width="1.8" stroke-linecap="round"/>
          <path d="M47 65 Q55 70 63 65" stroke="#546052" stroke-width="1.5" fill="none" stroke-linecap="round"/>
        </svg>`
      },
      {
        score: 2, label: 'Squinted eyes', sublabel: 'Markedly present',
        svg: `<svg viewBox="0 0 110 90" fill="none" xmlns="http://www.w3.org/2000/svg">
          <ellipse cx="55" cy="52" rx="30" ry="26" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <polygon points="32,34 22,14 44,30" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <polygon points="78,34 88,14 66,30" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <ellipse cx="42" cy="52" rx="8" ry="3" fill="white" stroke="#546052" stroke-width="1.5"/>
          <ellipse cx="68" cy="52" rx="8" ry="3" fill="white" stroke="#546052" stroke-width="1.5"/>
          <circle cx="42" cy="52" r="2" fill="#2a3329"/>
          <circle cx="68" cy="52" r="2" fill="#2a3329"/>
          <line x1="34" y1="49" x2="50" y2="49" stroke="#546052" stroke-width="2" stroke-linecap="round"/>
          <line x1="60" y1="49" x2="76" y2="49" stroke="#546052" stroke-width="2" stroke-linecap="round"/>
          <path d="M47 66 Q55 70 63 66" stroke="#546052" stroke-width="1.5" fill="none" stroke-linecap="round"/>
        </svg>`
      }
    ]
  },
  {
    id: 'muzzle',
    label: 'Muzzle Tension',
    options: [
      {
        score: 0, label: 'Relaxed (round shape)', sublabel: 'Absent',
        svg: `<svg viewBox="0 0 110 90" fill="none" xmlns="http://www.w3.org/2000/svg">
          <ellipse cx="55" cy="52" rx="30" ry="26" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <polygon points="32,34 22,14 44,30" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <polygon points="78,34 88,14 66,30" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <circle cx="44" cy="47" r="4.5" fill="#546052" opacity="0.6"/>
          <circle cx="66" cy="47" r="4.5" fill="#546052" opacity="0.6"/>
          <ellipse cx="55" cy="58" rx="3" ry="2" fill="#546052" opacity="0.55"/>
          <line x1="55" y1="60" x2="55" y2="64" stroke="#546052" stroke-width="1.2" stroke-linecap="round"/>
          <ellipse cx="46" cy="66" rx="7" ry="7" fill="white" stroke="#546052" stroke-width="1.3"/>
          <ellipse cx="64" cy="66" rx="7" ry="7" fill="white" stroke="#546052" stroke-width="1.3"/>
        </svg>`
      },
      {
        score: 1, label: 'Mild tension', sublabel: 'Moderately present or uncertain',
        svg: `<svg viewBox="0 0 110 90" fill="none" xmlns="http://www.w3.org/2000/svg">
          <ellipse cx="55" cy="52" rx="30" ry="26" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <polygon points="32,34 22,14 44,30" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <polygon points="78,34 88,14 66,30" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <circle cx="44" cy="47" r="4.5" fill="#546052" opacity="0.6"/>
          <circle cx="66" cy="47" r="4.5" fill="#546052" opacity="0.6"/>
          <ellipse cx="55" cy="58" rx="3" ry="2" fill="#546052" opacity="0.55"/>
          <line x1="55" y1="60" x2="55" y2="64" stroke="#546052" stroke-width="1.2" stroke-linecap="round"/>
          <ellipse cx="46" cy="66" rx="6.5" ry="8.5" fill="white" stroke="#546052" stroke-width="1.3"/>
          <ellipse cx="64" cy="66" rx="6.5" ry="8.5" fill="white" stroke="#546052" stroke-width="1.3"/>
        </svg>`
      },
      {
        score: 2, label: 'Tense (elliptical shape)', sublabel: 'Markedly present',
        svg: `<svg viewBox="0 0 110 90" fill="none" xmlns="http://www.w3.org/2000/svg">
          <ellipse cx="55" cy="52" rx="30" ry="26" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <polygon points="32,34 22,14 44,30" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <polygon points="78,34 88,14 66,30" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <circle cx="44" cy="47" r="4.5" fill="#546052" opacity="0.6"/>
          <circle cx="66" cy="47" r="4.5" fill="#546052" opacity="0.6"/>
          <ellipse cx="55" cy="58" rx="3" ry="2" fill="#546052" opacity="0.55"/>
          <line x1="55" y1="60" x2="55" y2="63" stroke="#546052" stroke-width="1.2" stroke-linecap="round"/>
          <ellipse cx="46" cy="66" rx="5.5" ry="10" fill="white" stroke="#546052" stroke-width="1.3"/>
          <ellipse cx="64" cy="66" rx="5.5" ry="10" fill="white" stroke="#546052" stroke-width="1.3"/>
        </svg>`
      }
    ]
  },
  {
    id: 'whiskers',
    label: 'Whiskers Change',
    options: [
      {
        score: 0, label: 'Loose and curved', sublabel: 'Absent',
        svg: `<svg viewBox="0 0 110 90" fill="none" xmlns="http://www.w3.org/2000/svg">
          <ellipse cx="55" cy="52" rx="28" ry="24" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <polygon points="33,36 24,16 44,32" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <polygon points="77,36 86,16 66,32" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <circle cx="44" cy="51" r="4" fill="#546052" opacity="0.6"/>
          <circle cx="66" cy="51" r="4" fill="#546052" opacity="0.6"/>
          <path d="M47 64 Q55 69 63 64" stroke="#546052" stroke-width="1.5" fill="none" stroke-linecap="round"/>
          <!-- curved whiskers -->
          <path d="M38 53 Q22 50 10 53" stroke="#546052" stroke-width="1.2" fill="none" stroke-linecap="round"/>
          <path d="M38 57 Q22 57 10 60" stroke="#546052" stroke-width="1.2" fill="none" stroke-linecap="round"/>
          <path d="M38 61 Q22 64 10 68" stroke="#546052" stroke-width="1.2" fill="none" stroke-linecap="round"/>
          <path d="M72 53 Q88 50 100 53" stroke="#546052" stroke-width="1.2" fill="none" stroke-linecap="round"/>
          <path d="M72 57 Q88 57 100 60" stroke="#546052" stroke-width="1.2" fill="none" stroke-linecap="round"/>
          <path d="M72 61 Q88 64 100 68" stroke="#546052" stroke-width="1.2" fill="none" stroke-linecap="round"/>
        </svg>`
      },
      {
        score: 1, label: 'Slightly curved or straight (closer together)', sublabel: 'Moderately present or uncertain',
        svg: `<svg viewBox="0 0 110 90" fill="none" xmlns="http://www.w3.org/2000/svg">
          <ellipse cx="55" cy="52" rx="28" ry="24" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <polygon points="33,36 24,16 44,32" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <polygon points="77,36 86,16 66,32" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <circle cx="44" cy="51" r="4" fill="#546052" opacity="0.6"/>
          <circle cx="66" cy="51" r="4" fill="#546052" opacity="0.6"/>
          <path d="M47 64 Q55 69 63 64" stroke="#546052" stroke-width="1.5" fill="none" stroke-linecap="round"/>
          <!-- straighter whiskers -->
          <line x1="38" y1="54" x2="10" y2="54" stroke="#546052" stroke-width="1.2" stroke-linecap="round"/>
          <line x1="38" y1="58" x2="10" y2="58" stroke="#546052" stroke-width="1.2" stroke-linecap="round"/>
          <line x1="38" y1="62" x2="10" y2="63" stroke="#546052" stroke-width="1.2" stroke-linecap="round"/>
          <line x1="72" y1="54" x2="100" y2="54" stroke="#546052" stroke-width="1.2" stroke-linecap="round"/>
          <line x1="72" y1="58" x2="100" y2="58" stroke="#546052" stroke-width="1.2" stroke-linecap="round"/>
          <line x1="72" y1="62" x2="100" y2="63" stroke="#546052" stroke-width="1.2" stroke-linecap="round"/>
        </svg>`
      },
      {
        score: 2, label: 'Straight and moving forward', sublabel: 'Markedly present',
        svg: `<svg viewBox="0 0 110 90" fill="none" xmlns="http://www.w3.org/2000/svg">
          <ellipse cx="55" cy="52" rx="28" ry="24" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <polygon points="33,36 24,16 44,32" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <polygon points="77,36 86,16 66,32" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <circle cx="44" cy="51" r="4" fill="#546052" opacity="0.6"/>
          <circle cx="66" cy="51" r="4" fill="#546052" opacity="0.6"/>
          <path d="M47 64 Q55 69 63 64" stroke="#546052" stroke-width="1.5" fill="none" stroke-linecap="round"/>
          <!-- forward-pointing whiskers -->
          <line x1="38" y1="55" x2="6" y2="51" stroke="#546052" stroke-width="1.2" stroke-linecap="round"/>
          <line x1="38" y1="58" x2="6" y2="58" stroke="#546052" stroke-width="1.2" stroke-linecap="round"/>
          <line x1="38" y1="61" x2="6" y2="65" stroke="#546052" stroke-width="1.2" stroke-linecap="round"/>
          <line x1="72" y1="55" x2="104" y2="51" stroke="#546052" stroke-width="1.2" stroke-linecap="round"/>
          <line x1="72" y1="58" x2="104" y2="58" stroke="#546052" stroke-width="1.2" stroke-linecap="round"/>
          <line x1="72" y1="61" x2="104" y2="65" stroke="#546052" stroke-width="1.2" stroke-linecap="round"/>
        </svg>`
      }
    ]
  },
  {
    id: 'head',
    label: 'Head Position',
    options: [
      {
        score: 0, label: 'Head above the shoulder line', sublabel: 'Absent',
        svg: `<svg viewBox="0 0 110 90" fill="none" xmlns="http://www.w3.org/2000/svg">
          <!-- body -->
          <ellipse cx="55" cy="72" rx="32" ry="16" fill="#dce6da" stroke="#546052" stroke-width="1.5"/>
          <!-- head high -->
          <ellipse cx="55" cy="40" rx="22" ry="20" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <polygon points="40,26 32,10 50,24" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <polygon points="70,26 78,10 60,24" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <circle cx="46" cy="40" r="4" fill="#546052" opacity="0.6"/>
          <circle cx="64" cy="40" r="4" fill="#546052" opacity="0.6"/>
          <!-- shoulder line dashes -->
          <line x1="10" y1="58" x2="100" y2="58" stroke="#aaa" stroke-width="1" stroke-dasharray="4,3"/>
        </svg>`
      },
      {
        score: 1, label: 'Head aligned with the shoulder line', sublabel: 'Moderately present or uncertain',
        svg: `<svg viewBox="0 0 110 90" fill="none" xmlns="http://www.w3.org/2000/svg">
          <ellipse cx="55" cy="72" rx="32" ry="16" fill="#dce6da" stroke="#546052" stroke-width="1.5"/>
          <!-- head level -->
          <ellipse cx="55" cy="52" rx="22" ry="20" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <polygon points="40,38 32,20 50,36" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <polygon points="70,38 78,20 60,36" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <circle cx="46" cy="52" r="4" fill="#546052" opacity="0.6"/>
          <circle cx="64" cy="52" r="4" fill="#546052" opacity="0.6"/>
          <line x1="10" y1="58" x2="100" y2="58" stroke="#aaa" stroke-width="1" stroke-dasharray="4,3"/>
        </svg>`
      },
      {
        score: 2, label: 'Head below the shoulder line or tilted down', sublabel: 'Markedly present',
        svg: `<svg viewBox="0 0 110 90" fill="none" xmlns="http://www.w3.org/2000/svg">
          <ellipse cx="55" cy="72" rx="32" ry="14" fill="#dce6da" stroke="#546052" stroke-width="1.5"/>
          <!-- head low/down -->
          <ellipse cx="55" cy="66" rx="22" ry="18" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <polygon points="40,52 33,34 50,50" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <polygon points="70,52 77,34 60,50" fill="#edf1ec" stroke="#546052" stroke-width="1.5"/>
          <circle cx="46" cy="65" r="4" fill="#546052" opacity="0.6"/>
          <circle cx="64" cy="65" r="4" fill="#546052" opacity="0.6"/>
          <line x1="10" y1="58" x2="100" y2="58" stroke="#aaa" stroke-width="1" stroke-dasharray="4,3"/>
        </svg>`
      }
    ]
  }
];

const scores = { ears: null, eyes: null, muzzle: null, whiskers: null, head: null };
const unitIds = ['ears', 'eyes', 'muzzle', 'whiskers', 'head'];

function getTotal() {
  return unitIds.reduce((sum, id) => sum + (scores[id] ?? 0), 0);
}

function getColorClass(total) {
  if (total === 0) return 'color-0';
  if (total <= 3) return 'color-mild';
  if (total <= 8) return 'color-pain';
  return 'color-severe';
}

function getBadgeClass(total) {
  if (total === 0) return 'badge-0';
  if (total <= 3) return 'badge-mild';
  if (total <= 8) return 'badge-pain';
  return 'badge-severe';
}

function getBadgeLabel(total) {
  if (total === 0) return 'No Pain';
  if (total <= 3) return 'Mild / No Pain';
  if (total <= 8) return 'Likely In Pain';
  return 'Severe Pain';
}

function getInterpText(total) {
  if (total === 0) return 'This cat is not in pain. If you are a cat owner and are concerned, please consult your veterinary surgeon.';
  if (total <= 3) return 'This cat is not in pain or has mild pain. Pain should be re-evaluated at regular intervals since FGS scores could increase, and the cat might require analgesics.';
  if (total <= 8) return 'This cat is likely to be in pain. This score indicates the need for additional analgesia. This decision should be made by a veterinary surgeon based on clinical judgement. If in doubt, reassess in 10‚Äì15 minutes.';
  return 'This cat is likely to be in severe pain. This score indicates the need for additional analgesia. This decision should be made by a veterinary surgeon. If in doubt, reassess in 10‚Äì15 minutes.';
}

function updateScorePanel() {
  const total = getTotal();
  const colorClass = getColorClass(total);

  const totalEl = document.getElementById('total-display');
  totalEl.textContent = total;
  totalEl.className = `total-number ${colorClass}`;
  totalEl.classList.add('pop-animate');
  totalEl.addEventListener('animationend', () => totalEl.classList.remove('pop-animate'), { once: true });

  const badge = document.getElementById('interp-badge');
  badge.className = `interp-badge ${getBadgeClass(total)}`;
  badge.textContent = getBadgeLabel(total);

  document.getElementById('interp-text').textContent = getInterpText(total);

  const fill = document.getElementById('progress-fill');
  const pct = (total / 10) * 100;
  fill.style.width = pct + '%';
  fill.className = `progress-fill ${colorClass}`;

  // update breakdown
  unitIds.forEach(id => {
    const el = document.getElementById(`score-val-${id}`);
    if (el) {
      el.textContent = scores[id] !== null ? scores[id] : '‚Äî';
      el.style.color = scores[id] !== null ? 'var(--purple)' : 'var(--text-muted)';
    }
  });

  // update unit score badges
  unitIds.forEach(id => {
    const badge = document.getElementById(`unit-badge-${id}`);
    if (badge) {
      if (scores[id] !== null) {
        badge.textContent = `Score: ${scores[id]}`;
        badge.classList.add('selected');
      } else {
        badge.textContent = 'Not scored';
        badge.classList.remove('selected');
      }
    }
  });
}

function buildUI() {
  const container = document.getElementById('units-container');
  const breakdown = document.getElementById('score-breakdown');

  // Build breakdown items
  const labels = ['Ears', 'Eyes', 'Muzzle', 'Whiskers', 'Head'];
  unitIds.forEach((id, i) => {
    const item = document.createElement('div');
    item.className = 'score-item';
    item.innerHTML = `<div class="score-item-label">${labels[i]}</div><div class="score-item-value" id="score-val-${id}">‚Äî</div>`;
    breakdown.appendChild(item);
  });

  // Build unit cards
  units.forEach(unit => {
    const card = document.createElement('div');
    card.className = 'unit-card';
    card.innerHTML = `
      <div class="unit-header">
        <h2>${unit.label}</h2>
        <span class="unit-score-badge" id="unit-badge-${unit.id}">Not scored</span>
      </div>
      <div class="options-row" role="group" aria-label="${unit.label}">
        ${unit.options.map(opt => `
          <button class="option-btn" data-unit="${unit.id}" data-score="${opt.score}" aria-pressed="false">
            <div class="score-pill">${opt.score}</div>
            <div class="cat-illustration">${opt.svg}</div>
            <div class="option-label">${opt.label}</div>
            <div class="option-sublabel">${opt.sublabel}</div>
          </button>
        `).join('')}
      </div>
    `;
    container.appendChild(card);
  });

  // Event delegation
  container.addEventListener('click', e => {
    const btn = e.target.closest('.option-btn');
    if (!btn) return;
    const unitId = btn.dataset.unit;
    const score = parseInt(btn.dataset.score);

    // deselect siblings
    const siblings = btn.closest('.options-row').querySelectorAll('.option-btn');
    siblings.forEach(s => { s.classList.remove('selected'); s.setAttribute('aria-pressed', 'false'); });

    // select this
    btn.classList.add('selected');
    btn.setAttribute('aria-pressed', 'true');
    scores[unitId] = score;

    updateScorePanel();
  });
}

buildUI();
updateScorePanel();
</script>
</body>

{{/partial}}
{{> layout/base}}